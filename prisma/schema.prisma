generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(cuid())
  clerkId          String   @unique
  telegramId       String?  @unique
  email            String?  @unique
  username         String?
  firstName        String?
  lastName         String?
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  defaultAccountId String?
  saveReceipts     Boolean  @default(false)

  @@map("users")
}

model Account {
  id           String        @id @default(cuid())
  name         String
  type         AccountType
  balance      Decimal       @default(0) @db.Decimal(10, 2)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  userId       String
  currency     Currency      @default(ARS)
  transactions Transaction[]

  @@map("accounts")
}

model Category {
  id           String          @id @default(cuid())
  name         String
  color        String?
  icon         String?
  type         TransactionType
  isDefault    Boolean         @default(false)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  userId       String?
  budgets      Budget[]
  transactions Transaction[]

  @@unique([name, type], name: "name_type")
  @@map("categories")
}

model Transaction {
  id          String          @id @default(cuid())
  amount      Decimal         @db.Decimal(10, 2)
  description String?
  type        TransactionType
  date        DateTime
  processed   Boolean         @default(false)
  aiExtracted Boolean         @default(false)
  metadata    Json?
  currency    Currency        @default(ARS)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  userId      String
  accountId   String
  categoryId  String?
  receiptId   String?         @unique
  account     Account         @relation(fields: [accountId], references: [id], onDelete: Cascade)
  category    Category?       @relation(fields: [categoryId], references: [id])
  receipt     Receipt?        @relation(fields: [receiptId], references: [id])

  @@map("transactions")
}

model Receipt {
  id            String       @id @default(cuid())
  fileName      String
  fileUrl       String
  fileSize      Int
  mimeType      String
  extracted     Boolean      @default(false)
  extractedData Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  userId        String
  transaction   Transaction?

  @@map("receipts")
}

model Budget {
  id         String       @id @default(cuid())
  name       String
  amount     Decimal      @db.Decimal(10, 2)
  spent      Decimal      @default(0) @db.Decimal(10, 2)
  period     BudgetPeriod
  startDate  DateTime
  endDate    DateTime?
  isActive   Boolean      @default(true)
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  userId     String
  categoryId String?
  category   Category?    @relation(fields: [categoryId], references: [id])

  @@map("budgets")
}

model investments {
  id            String   @id
  userId        String
  symbol        String
  companyName   String
  quantity      Decimal  @db.Decimal(12, 4)
  purchasePrice Decimal  @db.Decimal(10, 2)
  purchaseDate  DateTime
  currentPrice  Decimal? @db.Decimal(10, 2)
  currency      Currency @default(USD)
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model stock_prices {
  id            String   @id
  symbol        String   @unique
  companyName   String?
  price         Decimal  @db.Decimal(10, 2)
  change        Decimal? @db.Decimal(10, 2)
  changePercent Decimal? @db.Decimal(5, 2)
  currency      Currency @default(USD)
  lastUpdated   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime
}

model Subscription {
  id              String       @id @default(cuid())
  name            String
  description     String?
  amount          Decimal      @db.Decimal(10, 2)
  billingCycle    BillingCycle
  nextBillingDate DateTime
  isActive        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  userId          String
  accountId       String
  categoryId      String?

  @@map("subscriptions")
}

enum AccountType {
  CHECKING
  SAVINGS
  CREDIT_CARD
  CASH
  INVESTMENT
  OTHER
}

enum Currency {
  USD
  ARS
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}

enum BudgetPeriod {
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM
}

enum BillingCycle {
  MONTHLY
  YEARLY
}
